---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse, quietly = T)
```

```{r read files}
fnames <- c(
  "https://www2.ed.gov/programs/osepidea/618-data/state-level-data-files/part-b-data/dispute-resolution/bdispres2014-15.csv",
  "https://www2.ed.gov/programs/osepidea/618-data/state-level-data-files/part-b-data/dispute-resolution/bdispres2013-14.csv", 
  "https://www2.ed.gov/programs/osepidea/618-data/state-level-data-files/part-b-data/dispute-resolution/bdispres2012-13.csv"#,
  # Having trouble reading in the first row with these.
  #"https://www2.ed.gov/programs/osepidea/618-data/state-level-data-files/part-b-data/dispute-resolution/bdispres2011-12.csv",
  #"https://www2.ed.gov/programs/osepidea/618-data/state-level-data-files/part-b-data/dispute-resolution/bdispres2010-11.csv"
)

# Read files
allfiles <- lapply(fnames, function(x) {read_csv(
  x, 
  skip = 4, 
  col_types = cols(.default = "c"), 
  n_max = 61
  )})

# Combine and convert to tidy format
comb <- bind_rows(allfiles) %>%
  gather(category, total, -c(Year, State)) %>%
  mutate(total = as.numeric(total))
```

```{r by state in 14-15}
# Total due process complains in 14-15 by state
by_state_14 <- comb %>%
  filter(
    Year     == "2014-2015", 
    category == "Due Process Complaints (DPC) Total (3)"
    ) %>%
  arrange(desc(total))

ggplot(data = by_state_14, aes(x = State, y = total)) +
  geom_bar(stat = "identity") +
  coord_flip()
```

```{r by state in 13-14}
# Total due process complains in 13-14 by state
by_state_13 <- comb %>%
  filter(
    Year     == "2013-2014", 
    category == "Due Process Complaints (DPC) Total (3)"
    ) %>%
  arrange(desc(total))
```

```{r by state in 12-13}
# Total due process complains in 12-13 by state
by_state_12 <- comb %>%
  filter(
    Year     == "2012-2013", 
    category == "Due Process Complaints (DPC) Total (3)"
    ) %>%
  arrange(desc(total))
```

```{r}
ggplot(data = filter(
  comb, 
  category == "Due Process Complaints (DPC) Total (3)"), 
  aes(x = Year, y = total)) +
  geom_boxplot()
```

```{r}
# TODO Need to find a better way to explore year to year
#ggplot(data = filter(
#  comb,
#  category == "Due Process Complaints (DPC) Total (3)"),
#  aes(x = State, y = total)
#  ) +
#  geom_bar(stat = "identity") +
#  coord_flip() +
#  facet_wrap(~ Year)
```

